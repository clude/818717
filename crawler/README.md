# 综合

* 分布式星型爬虫框架，基于nodejs + socket.io

* 服务器端与节点

    1. 管理抓取节点的连接状态，配置信息
    2. 向节点推送，重设抓取脚本
    3. 建立，维护抓取地址列表，监控地址更新以及过期状态
    4. 维护节点抓取状态，推送抓取任务，管理任务过期
    5. 接收节点数据，丢给索引服务器

* 服务器端与管理端

    1. 服务器和节点的启动，停止
    2. 服务器和节点的状态报告
    3. 任务状态报告
    4. 立刻执行，重置，新建，管理任务
    5. 抓取脚本的管理，发布，以及客户端绑定

# 服务器端

* 数据模型

    1. 节点列表: [名称，IP，管理状态，上次连接，绑定脚本，当前任务，完成数，错误数，超时数，客户端负载]
    2. 脚本列表: [名称，脚本，更新时间，节点列表]
    3. 任务列表: [域名，地址，维护周期，重要性，更新时间，到期时间，工作节点，超时时间]
    4. 事件列表: 用于跟踪状态和调试

* 节点事件

    1. login: 启用节点
    3. update result: 节点更新结果
    4. crawl result: 节点抓取结果

* 管理频道

    1. start: 启动服务器/节点
    2. stop: 停止服务器/节点
    3. restart: 重启服务器/节点
    4. status: 状态检查
    5. update: 更新脚本
    6. crawl: 立刻抓取url
    7. load: 载入url地址列表，关联在域名上
    8. unload: 移除域名下的url列表
    9. refresh: 重设url列表的抓取状态

    注：操作后触发result事件，异步结果触发message事件

# 节点

* 服务器端事件
    1. update: 脚本更新，如不成功则回退, 触发update result事件
    2. crawl: 调用worker函数(来自服务器端脚本), 触发crawl result事件

* 节点和服务器端保持5s的无限断线重连间隔

# 管理端

* 服务器端事件

    1. result: 服务器端对命令的直接响应
    2. message：服务器端对命令的异步响应 / 服务器端的事件报告
